/* ********************************************************************************
 * The content of this file is subject to the ParsVT.com Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is ParsVT.com
 * Portions created by ParsVT.com. are Copyright(C) ParsVT Team
 * All Rights Reserved.
 * ****************************************************************************** */
Settings_Vtiger_List_Js("Settings_ParsVT_APIAccessList_Js",{registerEventforShowResponse:function(e){jQuery.each(["header","request","files","response"],(function(a,i){var s=jQuery("#"+i+"_value_"+e).val();if(0===jQuery(".jsoncontent#"+i+"_value_"+e).length)if(0===jQuery(".xmlcontent#"+i+"_value_"+e).length)jQuery("#"+i+"_result_"+e).html(s);else try{jQuery("#"+i+"_result_"+e).empty(),jQuery("#"+i+"_result_"+e).simpleXML({xmlString:s,collapsedText:" ... "}),jQuery("#"+i+"_result_"+e).css("display","contents"),jQuery("#"+i+"_result_"+e+" span.simpleXML-expanderHeader span.simpleXML-expander.simpleXML-expander-expanded:first").trigger("click")}catch(a){jQuery("#"+i+"_result_"+e).val(Settings_ParsVT_APIAccessList_Js.nl2br(s))}else try{var t=JSON.parse(s);new PrettyJSON.view.Node({el:jQuery("#"+i+"_result_"+e),data:t,level:2})}catch(a){jQuery("#"+i+"_result_"+e).val(Settings_ParsVT_APIAccessList_Js.nl2br(s))}}))},nl2br:function(e,a){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(a||void 0===a?"<br />":"<br>")+"$2")},viewAPILog:function(e){var a=this;app.helper.showProgress();var i={module:"ParsVT",action:"Fields",mode:"viewAPILog",record:e};app.request.post({data:i}).then((function(i,s){null==i&&(app.helper.showModal(s),app.helper.hideProgress(),$(".myModal").on("shown.bs.modal",(function(){setTimeout((function(){a.registerEventforShowResponse(e)}),1e3)})))}))},deleteAPILog:function(e){app.helper.showProgress();var a={module:"ParsVT",action:"Fields",mode:"deleteAPILog",record:e};app.request.post({data:a}).then((function(a,i){null==a&&(app.helper.hideProgress(),jQuery('.listViewEntries[data-id="'+e+'"]').remove(),app.helper.showSuccessNotification({message:app.vtranslate("JS_RECORD_DELETED")}))}))},deleteSelectedAPILogs:function(){var e=jQuery("#listViewContent").find("tr.listViewEntries"),a=[];e.find(".listViewEntriesCheckBox:checked").each((function(e){var i=jQuery(this).closest(".listViewEntries");a.push(i.data("id"))})),app.helper.showProgress();var i={module:"ParsVT",action:"Fields",mode:"deleteSelectedAPILogs",data:a};app.request.post({data:i}).then((function(e,a){null==e&&(app.helper.hideProgress(),app.helper.showSuccessNotification({message:app.vtranslate("JS_DELETED")}),setTimeout((function(){window.location.reload(1)}),1e3))}))},cleanAPILogs:function(){app.helper.showConfirmationBox({message:app.vtranslate("LBL_DELETE_CONFIRMATION")}).then((function(){app.helper.showProgress(app.vtranslate("JSLBL_Deleting")+"...");app.request.post({data:{module:"ParsVT",action:"Fields",mode:"cleanAPILogs"}}).then((function(e,a){null==e&&(app.helper.hideProgress(),setTimeout((function(){window.location.reload(1)}),1e3))}))}))}},{initializePaginationEvents:function(){var e=this,a=this.getComponentInstance("Vtiger_Pagination_Js"),i=e.getListViewContainer();a.initialize(i),app.event.on(a.nextPageButtonClickEventName,(function(){var e=i.find("#pageLimit").val(),a=i.find("#noOfEntries").val(),s=i.find("#nextPageExist").val(),t=i.find("#pageNumber").val(),o=parseInt(parseFloat(t))+1;if(a===e&&s){i.find("#pageNumber").val(o),t=i.find("#pageNumber").val();var r=i.find('[name="orderBy"]').val(),l=i.find('[name="sortOrder"]').val(),n=(i.find("#appName").val(),{});$("#apilogs_accesstime").length>0&&""!=$("#apilogs_accesstime").val()&&(n.accesstime=$("#apilogs_accesstime").val()),$("#apilogs_ip").length>0&&""!=$("#apilogs_ip").val()&&(n.ip=$("#apilogs_ip").val()),$("#apilogs_service").length>0&&""!=$("#apilogs_service").val()&&(n.service=$("#apilogs_service").val()),$("#apilogs_request").length>0&&""!=$("#apilogs_request").val()&&(n.request=$("#apilogs_request").val()),$("#apilogs_operation").length>0&&""!=$("#apilogs_operation").val()&&(n.operation=$("#apilogs_operation").val()),$("#apilogs_userid").length>0&&""!=$("#apilogs_userid").val()&&(n.userid=$("#apilogs_userid").val());var p={module:"ParsVT",parent:"Settings",page:t,view:"APIAccessList",orderby:r,sortorder:l,search_params:JSON.stringify(n)};return window.location.href="index.php?"+$.param(p),!0}})),app.event.on(a.previousPageButtonClickEventName,(function(){var e=i.find("#pageNumber").val(),a=parseInt(parseFloat(e))-1;if(e>1){i.find("#pageNumber").val(a),e=i.find("#pageNumber").val();var s=i.find('[name="orderBy"]').val(),t=i.find('[name="sortOrder"]').val(),o=(i.find("#appName").val(),{});$("#apilogs_accesstime").length>0&&""!=$("#apilogs_accesstime").val()&&(o.accesstime=$("#apilogs_accesstime").val()),$("#apilogs_ip").length>0&&""!=$("#apilogs_ip").val()&&(o.ip=$("#apilogs_ip").val()),$("#apilogs_service").length>0&&""!=$("#apilogs_service").val()&&(o.service=$("#apilogs_service").val()),$("#apilogs_request").length>0&&""!=$("#apilogs_request").val()&&(o.request=$("#apilogs_request").val()),$("#apilogs_operation").length>0&&""!=$("#apilogs_operation").val()&&(o.operation=$("#apilogs_operation").val()),$("#apilogs_userid").length>0&&""!=$("#apilogs_userid").val()&&(o.userid=$("#apilogs_userid").val());var r={module:"ParsVT",parent:"Settings",page:e,view:"APIAccessList",orderby:s,sortorder:t,search_params:JSON.stringify(o)};return window.location.href="index.php?"+$.param(r),!0}})),app.event.on(a.pageJumpButtonClickEventName,(function(a,i){e.pageJump()})),app.event.on(a.totalNumOfRecordsButtonClickEventName,(function(a,i){e.totalNumOfRecords(i)})),app.event.on(a.pageJumpSubmitButtonClickEvent,(function(a,i){e.pageJumpOnSubmit(i)}))},pageJumpOnSubmit:function(e){var a=this.getListViewContainer(),i=a.find("#pageNumber"),s=parseInt(i.val()),t=parseInt(a.find("#pageToJump").val());if(t>parseInt(a.find("#totalPageCount").text())){var o=app.vtranslate("JS_PAGE_NOT_EXIST");app.helper.showErrorNotification({message:o})}else if(t!==s){e.closest(".btn-group ").removeClass("open");var r=a.find('[name="orderBy"]').val(),l=a.find('[name="sortOrder"]').val(),n={};$("#apilogs_accesstime").length>0&&""!=$("#apilogs_accesstime").val()&&(n.accesstime=$("#apilogs_accesstime").val()),$("#apilogs_ip").length>0&&""!=$("#apilogs_ip").val()&&(n.ip=$("#apilogs_ip").val()),$("#apilogs_service").length>0&&""!=$("#apilogs_service").val()&&(n.service=$("#apilogs_service").val()),$("#apilogs_request").length>0&&""!=$("#apilogs_request").val()&&(n.request=$("#apilogs_request").val()),$("#apilogs_operation").length>0&&""!=$("#apilogs_operation").val()&&(n.operation=$("#moduleName").val()),$("#apilogs_userid").length>0&&""!=$("#apilogs_userid").val()&&(n.userid=$("#apilogs_userid").val());var p={module:"ParsVT",parent:"Settings",page:t,view:"APIAccessList",orderby:r,sortorder:l,search_params:JSON.stringify(n)};window.location.href="index.php?"+$.param(p)}else{o=app.vtranslate("JS_YOU_ARE_IN_PAGE_NUMBER")+" "+t;app.helper.showAlertNotification({message:o})}},getPageJumpParams:function(){var e=app.getModuleName(),a=app.getParentModuleName(),i={};return $("#apilogs_accesstime").length>0&&""!=$("#apilogs_accesstime").val()&&(i.accesstime=$("#apilogs_accesstime").val()),$("#apilogs_ip").length>0&&""!=$("#apilogs_ip").val()&&(i.ip=$("#apilogs_ip").val()),$("#apilogs_service").length>0&&""!=$("#apilogs_service").val()&&(i.service=$("#apilogs_service").val()),$("#apilogs_request").length>0&&""!=$("#apilogs_request").val()&&(i.request=$("#apilogs_request").val()),$("#apilogs_operation").length>0&&""!=$("#apilogs_operation").val()&&(i.operation=$("#apilogs_operation").val()),$("#apilogs_userid").length>0&&""!=$("#apilogs_userid").val()&&(i.userid=$("#apilogs_userid").val()),{module:e,parent:a,view:"APIAccessListAjax",mode:"getPageCount",search_params:i}},registerSensitiveListViewSearch:function(){var e=this.getListViewContainer(),a=app.getModuleName(),i=app.getParentModuleName();e.on("click",'[data-trigger="apilogs_listSearch"]',(function(e){e.preventDefault();var s={};$("#apilogs_accesstime").length>0&&""!=$("#apilogs_accesstime").val()&&(s.accesstime=$("#apilogs_accesstime").val()),$("#apilogs_ip").length>0&&""!=$("#apilogs_ip").val()&&(s.ip=$("#apilogs_ip").val()),$("#apilogs_service").length>0&&""!=$("#apilogs_service").val()&&(s.service=$("#apilogs_service").val()),$("#apilogs_request").length>0&&""!=$("#apilogs_request").val()&&(s.request=$("#apilogs_request").val()),$("#apilogs_operation").length>0&&""!=$("#apilogs_operation").val()&&(s.operation=$("#apilogs_operation").val()),$("#apilogs_userid").length>0&&""!=$("#apilogs_userid").val()&&(s.userid=$("#apilogs_userid").val());var t={module:a,parent:i,view:"APIAccessList",page:"1",search_params:JSON.stringify(s)};window.location.href="index.php?"+$.param(t)})),e.on("click",'[data-trigger="apilogs_ClearSearch"]',(function(e){e.preventDefault();var s={module:a,parent:i,view:"APIAccessList"};window.location.href="index.php?"+$.param(s)}))},registerCopyToClipboard:function(){$(document).on("click",".copyToClipboard",(function(e){var a=$(this).data("name");document.getElementById(a).select(),document.execCommand("copy"),app.helper.showSuccessNotification({message:app.vtranslate("JS_COPIED_SUCCESSFULLY")})}))},registerCheckBoxClickEvent:function(){var e=jQuery("#listViewContent");e.on("click",".listViewEntriesCheckBox",(function(a){var i=e.find(a.currentTarget);i.closest(".listViewEntries");i.is(":checked")?$(".deleteLogs").removeClass("hide"):0==e.find(".listViewEntriesCheckBox:checked").length?$(".deleteLogs").addClass("hide"):$(".deleteLogs").removeClass("hide"),0==e.find(".listViewEntriesCheckBox").not(":checked").length?(e.find(".listViewEntriesMainCheckBox").prop("checked",!0),$(".cleanLogs").removeClass("hide")):(e.find(".listViewEntriesMainCheckBox").prop("checked",!1),$(".cleanLogs").addClass("hide"))})),e.on("click",".listViewEntriesMainCheckBox",(function(a){(a.stopPropagation(),jQuery(a.currentTarget).is(":checked"))?e.find("tr.listViewEntries").find(".listViewEntriesCheckBox").each((function(e){jQuery(this).prop("checked",!0),$(".deleteLogs").removeClass("hide"),$(".cleanLogs").removeClass("hide")})):jQuery(".listViewEntriesCheckBox").each((function(e){jQuery(this).prop("checked",!1),$(".deleteLogs").addClass("hide"),$(".cleanLogs").addClass("hide")}))}))},registerEvents:function(){this._super(),this.registerSensitiveListViewSearch(),this.registerCopyToClipboard(),this.registerCheckBoxClickEvent()}});
