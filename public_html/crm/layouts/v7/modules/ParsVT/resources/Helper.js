/* ********************************************************************************
 * The content of this file is subject to the ParsVT.com Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is ParsVT.com
 * Portions created by ParsVT.com. are Copyright(C) ParsVT Team
 * All Rights Reserved.
 * ****************************************************************************** */
var InventoryModulesNames=["Invoice","Quotes","PurchaseOrder","SalesOrder"],Vtiger_ParsVT_Js={detailViewContentHolder:!1,getContentHolder:function(){return 0==this.detailViewContentHolder&&(this.detailViewContentHolder=jQuery("div.details div.contents")),this.detailViewContentHolder},getSelectedTab:function(){return this.getTabContainer().find("li.active")},getTabContainer:function(){return jQuery("div.related")},getRelatedModuleName:function(){return jQuery(".relatedModuleName",this.getContentHolder()).val()},getRecordId:function(){return jQuery("#recordId").val()},ClearCampaign:function(e,t){var a=this,r="module=ParsVT&action=ListDelete&campaign="+e+"&list="+t;AppConnector.request(r+"&mode=control").then((function(e){if(1==e.result.success){var n=e.result.message;app.helper.showConfirmationBox({message:n}).then((function(e){AppConnector.request(r).then((function(e){1==e.success&&(1==e.result.success?(app.helper.showSuccessNotification({message:e.result.message}),setTimeout((function(){window.location.reload(1)}),3e3)):app.helper.showErrorNotification({message:e.result.message}));var r=a.getSelectedTab(),n=a.getRelatedModuleName();(selectedTabLabelKey=r.data("label-key"),selectedTabLabelKey==t)&&new Campaigns_RelatedList_Js(a.getRecordId(),app.getModuleName(),r,n).loadRelatedList()}))}),(function(e,t){}))}else app.helper.showErrorNotification({message:e.result.message})}))},getVtigerVersion:function(){for(var e="",t=document.getElementsByTagName("script"),a=0;a<t.length;++a){var r=t[a].src;if(r.indexOf(".js?v=")>-1){e=r.split("js?v=")[1];break}if(r.indexOf(".js?&v=")>-1){e=r.split(".js?&v=")[1];break}}return e},versionCompare:function(e,t,a){var r=a&&a.lexicographical,n=a&&a.zeroExtend,i=e.split("."),o=t.split(".");function s(e){return(r?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!i.every(s)||!o.every(s))return NaN;if(n){for(;i.length<o.length;)i.push("0");for(;o.length<i.length;)o.push("0")}r||(i=i.map(Number),o=o.map(Number));for(var l=0;l<i.length;++l){if(o.length==l)return 1;if(i[l]!=o[l])return i[l]>o[l]?1:-1}return i.length!=o.length?-1:0},registerTopMenu:function(e,t){var a=this,r=a.getVtigerVersion(),n="";a.versionCompare(r,"7.0.0")>=0&&(n="<style>#page{padding-top: 124px;} @media (min-width: 1000px){#page{padding-top: 124px;}}</style>");var i='<div id="LicenseToolbar" class="row" style="background: #2c3b49;color: red;directories:rtl;"><div class="col-lg-1 col-md-1"><span class="fa fa-bullhorn" style="font-size: 26px;color: #fff;background: #c22f2f;padding: 7px 8px;"></span></div><div class="col-lg-7 col-md-7" style="font-size: 12px;text-align: center;line-height: 30px!important;color: #fff;"><p id="mytext"></p><p id="console"></p></div><div class="col-lg-4 col-md-4"><span id="CloseLicenseToolbar" class="fa fa-remove" style="cursor: pointer;;font-size: 26px;color: #fff;background: #c22f2f;padding: 7px 8px;float:'+("fa"==jQuery("body").data("language").substring(0,2)||"ar"==jQuery("body").data("language").substring(0,2)?"left":"right")+'"></span><button type="button"  onclick="window.open(\'http://my.vtiger.ir/submitticket.php?step=2&deptid=8\')" class="btn btn-warning btn-lg custom-header-btn-preview pull-right" style="position: relative; border-radius: 2px !important;height:38px;margin-left:10px;"><span style="line-height: 24px; font-size: 11px; padding: 0px;height: 38px;">'+t[0]+'</span><button type="button" onclick="window.location.href=\'index.php?module=ParsVT&parent=Settings&view=License\'" class="btn btn-success btn-lg custom-header-btn-purchase pull-right" style="position: relative; border-radius: 2px !important;margin-left:10px;height:38px;"><span style="line-height: 24px; font-size: 11px; padding: 0px;height: 38px;">'+t[1]+'</span></button></div></div><div style="clear: both;"></div>'+n;$(".global-nav").before(i),a.consoleText(e,"mytext",["Snow","yellow"])},requestCheckSalahTimes:function(){var e={action:"ActionAjax",module:"ParsVT",mode:"isAdhanTime"};app.request.post({data:e}).then((function(e,t){if(null==e){if(!t.result.result)return!1;Vtiger_ParsVT_Js.ShowAdhanNotification(t.result.message,t.result.next,t.result.title,t.result.mp3)}}))},checkPermissionForAdhan:function(){var e={action:"ActionAjax",module:"ParsVT",mode:"checkPermissionForAdhan"};app.request.post({data:e}).then((function(e,t){null==e&&(t&&t.result&&(Vtiger_ParsVT_Js.registerSalah()||setInterval((function(){Vtiger_ParsVT_Js.registerSalah()}),6e4)))}))},registerSalah:function(){var e=app.storage.get("Adhan"),t=Math.round((new Date).getTime()/1e3);if(null!==e&&t<e+300)return!1;Vtiger_ParsVT_Js.requestCheckSalahTimes()},registerSettingsBtn:function(){var e={action:"ActionAjax",module:"ParsVT",mode:"checkEnable"};"Detail"!=app.view()&&"PreferenceDetail"!=app.view()||"Users"!=app.getModuleName()||app.request.post({data:e}).then((function(e,t){if(null==e&&"1"==t.enable){for(var a="",r="",n=window.location.search.substring(1).split("&"),i=0;i<n.length;i++){var o=n[i].split("=");"module"==o[0]?a=o[1]:"view"==o[0]?r=o[1]:"record"==o[0]&&o[1]}if("Users"==a&&("Detail"==r||"PreferenceDetail"==r)){var s=jQuery(".detailViewContainer").find(".btn-group"),l=jQuery(t.button);s.find(".btn-default:last").before(l)}}}))},registerStartParsVT:function(){var e=this,t={action:"ActionAjax",module:"ParsVT",mode:"registerHelp"},a=jQuery(".navbar-nav .register_help_btn");jQuery(window).width()>=900&&0==a.length&&app.request.post({data:t}).then((function(t,a){if(null==t&&"1"==a.enable){for(var r="",n=window.location.search.substring(1).split("&"),i=0;i<n.length;i++){var o=n[i].split("=");"module"==o[0]?r=o[1]:"view"==o[0]?o[1]:"record"==o[0]&&o[1]}var s=jQuery(".module-action-content").find(".navbar-right");$("<style type='text/css'>.register_help_btn{margin-top:3px;outline:0;display:inline-flex;align-items:center;justify-content:space-between;background:#ef5e29;min-width:100px;border:0;border-radius:4px;box-shadow:0 4px 12px rgba(0,0,0,0.1);box-sizing:border-box;padding:8px 10px;color:#FFF;font-size:12px;font-weight:600;text-transform:uppercase;overflow:hidden;cursor:pointer}.register_help_btn:focus .dropdown,.register_help_btn:active .dropdown{-webkit-transform:translate(0,20px);transform:translate(0,20px);opacity:1;visibility:visible}.register_help_btn .material-icons{border-radius:100%;-webkit-animation:ripple .6s linear infinite;animation:ripple .6s linear infinite}@-webkit-keyframes ripple{0%{box-shadow:0 0 0 0 rgba(255,255,255,0.1),0 0 0 20px rgba(255,255,255,0.1),0 0 0 40px rgba(255,255,255,0.1),0 0 0 60px rgba(255,255,255,0.1)}100%{box-shadow:0 0 0 20px rgba(255,255,255,0.1),0 0 0 40px rgba(255,255,255,0.1),0 0 0 60px rgba(255,255,255,0.1),0 0 0 80px rgba(255,255,255,0)}}@keyframes ripple{0%{box-shadow:0 0 0 0 rgba(255,255,255,0.1),0 0 0 20px rgba(255,255,255,0.1),0 0 0 40px rgba(255,255,255,0.1),0 0 0 60px rgba(255,255,255,0.1)}100%{box-shadow:0 0 0 20px rgba(255,255,255,0.1),0 0 0 40px rgba(255,255,255,0.1),0 0 0 60px rgba(255,255,255,0.1),0 0 0 80px rgba(255,255,255,0)}} </style>").appendTo("head"),"Reports"==r?s.append(a.button):s.find(".navbar-nav").append(a.button),e.registerEventForHelper(),e.registerEventgetPageVideo()}}))},registerEventForHelper:function(){jQuery(".module-action-content").on("click",".register_help_btn",(function(e){if(jQuery("#helperContainer").length>0)return app.helper.hidePageOverlay(),!1;var t={module:"ParsVT",view:"Helper",mode:"showHelperView",data:{module:app.getModuleName(),view:app.getViewName(),parent:app.getParentModuleName()}};app.helper.showProgress(),app.request.post({data:t}).then((function(e,t){app.helper.hideProgress(),null===e?app.helper.loadPageOverlay(t,{ignoreScroll:!0,backdrop:"static"}).then((function(){$("#overlayPage").find(".data").css("height","300vh"),$("#overlayPage").css("top","85px");var e=jQuery(".register_help_btn").offset();$("#overlayPage").find(".arrow").css("left",e.left+35),$("#overlayPage").find(".arrow").addClass("show"),$("#overlayPage").find(".modal-body").css("overflow","auto");var t=$(".modal-header");t.position();if(app.helper.showVerticalScroll(jQuery(".modal-body"),{setHeight:window.innerHeight-85-t.height()+"px"}),$(".modal-body").removeClass("overflowYAuto"),jQuery("#ticketdepartment").length>0){var a=jQuery("#ticketdepartment");vtUtils.showSelect2ElementView(a,{})}})):app.helper.showErrorNotification({message:e})}))}))},registerEventgetPageVideo:function(){jQuery("body").on("click",".pars_video_category_btn",(function(e){var t=$("#parscategory").children().clone();$("#HelperTutorials").empty(),$("#HelperTutorials").append(t)})),jQuery("body").on("click",".pars_video_refresh_btn",(function(e){app.helper.showProgress(),app.request.post({data:{module:"ParsVT",view:"Helper",action:"ActionAjax",mode:"SetRefreshVideoList"}}).then((function(e,t){null===e?(app.helper.hideProgress(),app.helper.showSuccessNotification({message:t.message}),$(".pars_video_refresh_btn").css("display","none"),window.setTimeout((function(){$("button.close").trigger("click")}),3e3)):app.helper.showErrorNotification({message:e})}))})),jQuery("body").on("click",".subvideo",(function(e){var t=$(this).data("id"),a={module:"ParsVT",view:"Helper",action:"ActionAjax",mode:"getHelperPageVideo",data:{id:t}};app.helper.showProgress(),app.request.post({data:a}).then((function(e,a){if(null===e){app.helper.hideProgress();var r=null,n={};$.each(a.message[0],(function(e,a){a.id==t?r=a:n[a.id]=a}));var i="";i="URL"==r.upload_type?r.path_video:'<video width="100%" controls controlsList="nodownload"> <source src="'+r.path_video+'" type="video/mp4"></video>';var o="";if(Object.keys(n).length>=1){var s="";$.each(n,(function(e,t){var a="http://license.aweb.co/videos/default_video.png";""!=t.path_picture&&(a=t.path_picture),s=(s=(s+='<div class="panel panel-default">')+'<div class="panel-footer"><i class="fa fa-video-camera" aria-hidden="true"></i><div class="title">'+t.title+"</div></div>")+'<div class="panel-body subvideo" data-id="'+e+'"><img class="parsvideoimage" src="'+a+'" width="100%"><button class="btn btn-primary pars_video_btn" data-id="'+e+'" style="margin: 10px">'+t.title+"</button></div>",s+="</div>"})),o="<span>"+PVTHelpers.tr9+'</span>\n<br>\n<div class="pars_video_div">\n'+s+"\n</div>"}$(".pars_video_div").empty(),$(".pars_video_div").append(o);var l="";if(""!=r.related_video[0]){s="";$.each(r.related_video,(function(e,t){s=(s=(s+='<div class="col-lg-3"><div class="panel panel-default">')+'<div class="panel-footer"><i class="fa fa-video-camera" aria-hidden="true"></i><div class="title">'+t+"</div></div>")+'<div class="panel-body  subrelvideo"  data-name="'+t+'"><img class="parsvideoimage" src="http://license.aweb.co/videos/default_video.png" width="100%"><button class="btn btn-primary pars_relatedvideo_btn" data-name="'+t+'" style="margin: 10px">'+t+"</button></div>",s+="</div></div>"})),l='<div class="pars_relatedvideo_div">\n<hr>\n<span>'+PVTHelpers.tr1+"</span>\n<br>\n"+s+"\n</div>"}var d='<div class="row-fluid pars_video_source">\n<h2>'+r.title+"</h2>\n"+i+"\n<span>"+r.comment+"</span>\n</div>\n<br>\n"+l;$("#HelperTutorials").empty(),$("#HelperTutorials").append(d)}else app.helper.showErrorNotification({message:e})}))})),jQuery("body").on("click",".subrelvideo",(function(e){var t=$(this).data("name"),a={module:"ParsVT",view:"Helper",action:"ActionAjax",mode:"getHelperPageVideo",data:{name:t}};app.helper.showProgress(),app.request.post({data:a}).then((function(e,a){if(null===e){app.helper.hideProgress();var r=null,n={};$.each(a.message[0],(function(e,a){a.title==t?r=a:n[a.id]=a}));var i="";i="URL"==r.upload_type?r.path_video:'<video width="100%" controls controlsList="nodownload"> <source src="'+r.path_video+'" type="video/mp4"></video>';var o="";if(Object.keys(n).length>=1){var s="";$.each(n,(function(e,t){var a="http://license.aweb.co/videos/default_video.png";""!=t.path_picture&&(a=t.path_picture),s=(s=(s+='<div class="panel panel-default">')+'<div class="panel-footer"><i class="fa fa-video-camera" aria-hidden="true"></i><div class="title">'+t.title+"</div></div>")+'<div class="panel-body subvideo" data-id="'+e+'"><img class="parsvideoimage" src="'+a+'" width="100%"><button class="btn btn-primary pars_video_btn" data-id="'+e+'" style="margin: 10px">'+t.title+"</button></div>",s+="</div>"})),o="<span>"+PVTHelpers.tr9+'</span>\n<br>\n<div class="pars_video_div">\n'+s+"\n</div>"}$(".pars_video_div").empty(),$(".pars_video_div").append(o);var l="";if(""!=r.related_video[0]){s="";$.each(r.related_video,(function(e,t){s=(s=(s+='<div class="col-lg-3"><div class="panel panel-default">')+'<div class="panel-footer"><i class="fa fa-video-camera" aria-hidden="true"></i><div class="title">'+t+"</div></div>")+'<div class="panel-body  subrelvideo"  data-name="'+t+'"><img src="http://license.aweb.co/videos/default_video.png" width="100%"><button class="btn btn-primary pars_relatedvideo_btn" data-name="'+t+'" style="margin: 10px">'+t+"</button></div>",s+="</div></div>"})),l='<div class="pars_relatedvideo_div">\n<hr>\n<span>'+PVTHelpers.tr1+"</span>\n<br>\n"+s+"\n</div>"}var d='<div class="row-fluid pars_video_source">\n<h2>'+r.title+"</h2>\n"+i+"\n<span>"+r.comment+"</span>\n</div>\n<br>\n"+l;$("#HelperTutorials").empty(),$("#HelperTutorials").append(d)}else app.helper.showErrorNotification({message:e})}))})),jQuery("body").on("click",".helper_ticket_button",(function(e){var t=$('input[name = "ticketsubject"]').val(),a=$('textarea[name = "ticketcontent"]').val(),r=$("#ticketdepartment").val(),n={subject:t,content:a,department:r},i=!1;if($('input[name = "ticketsubject"]').css("border","1px solid #cccccc"),$('textarea[name = "ticketcontent"]').css("border","1px solid #ff0000;"),$('input[name = "ticketdepartment"]').css("border","1px solid #ff0000;"),""===t?($('input[name = "ticketsubject"]').css("border","1px solid #ff0000"),app.helper.showErrorNotification({message:app.vtranslate("JS_REQUIRED_FIELD")}),i=!0):""===a?($('textarea[name = "ticketcontent"]').css("border","1px solid #ff0000"),app.helper.showErrorNotification({message:app.vtranslate("JS_REQUIRED_FIELD")}),i=!0):""===r&&($("#ticketdepartment").css("border","1px solid #ff0000"),app.helper.showErrorNotification({message:app.vtranslate("JS_REQUIRED_FIELD")}),i=!0),!0!==i){var o={module:"ParsVT",view:"Helper",action:"ActionAjax",mode:"sendTicket",data:n};app.helper.showProgress(),app.request.post({data:o}).then((function(e,t){app.helper.hideProgress(),null===e?(t.success?app.helper.showSuccessNotification({message:PVTHelpers.tr2}):app.helper.showSuccessNotification({message:PVTHelpers.tr3}),$("#parsvtticket").html(t.message)):app.helper.showSuccessNotification({message:PVTHelpers.tr3})}))}})),jQuery("body").on("click",".Tutorials",(function(e){$(".refreshVideoList").css("display","block"),$(".pars_video_div").css("display","block")})),jQuery("body").on("click",".HelpDesk",(function(e){$(".refreshVideoList").css("display","none"),$(".pars_video_div").css("display","none")})),jQuery("body").on("click",".About",(function(e){$(".refreshVideoList").css("display","none"),$(".pars_video_div").css("display","none")}))},ShowAdhanNotification:function(e,t,a,r){var n={title:'<i id="reminder-postpone-" title="'+e+'" class="cursorPointer fa fa-clock-o"></i> '+a+'  <span id="timer"></span>',message:"<div class='row'><div class='col-sm-12 col-md-12'><div class='caption'><a href='index.php?module=ParsVT&view=PrayTimes'><h3 style='background: #1cbc62;border-radius: 3px;padding:6px;text-align: center;font-size: 13px;'>"+e+" - "+t+"</h3></a></div></div><div class='col-sm-12 col-md-12'><center><audio id='adhan' controls autoplay  preload='auto'><source src='"+r+"' type='audio/mpeg'></audio></center></div>"};jQuery.notify(n,{delay:1e3,timer:4e5,element:"body",type:"danger"}),app.storage.set("Adhan",Math.round((new Date).getTime()/1e3));var i=new Date(Date());setInterval((function(){i.setSeconds(i.getSeconds()+1),$("#timer").text("-  "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds())}),1e3),$("#adhan").length&&0==$("#adhan").get(0).paused&&$("#adhan").get(0).play()},consoleText:function(e,t,a){void 0===a&&(a=["#fff"]);var r=!0,n=document.getElementById("console"),i=1,o=1,s=!1,l=document.getElementById(t);l.setAttribute("style","color:"+a[0]),window.setInterval((function(){0===i&&!1===s?(s=!0,l.innerHTML=e[0].substring(0,i),window.setTimeout((function(){var t=a.shift();a.push(t);var r=e.shift();e.push(r),o=1,l.setAttribute("style","color:"+a[0]),i+=o,s=!1}),1e3)):i===e[0].length+1&&!1===s?(s=!0,window.setTimeout((function(){i+=o=-1,s=!1}),1e3)):!1===s&&(l.innerHTML=e[0].substring(0,i),i+=o)}),60),window.setInterval((function(){!0===r?(n.className="console-underscore hidden",r=!1):(n.className="console-underscore",r=!0)}),200)},initLayoutEditor:function(){var e=this,t=jQuery("#layoutEditorContainer");app.request.get({url:"index.php?module=ParsVT&action=ActionAjax&mode=LayoutEditorNotification"}).then((function(t,a){null===t&&(a.tooltip&&e.registerLayoutEditorTooltip(a.tooltiplabel),$("#detailViewLayout div:eq(0)").before(a.translate))})),jQuery(".editFields",t).on("dblclick",(function(e){e.stopPropagation();var t="index.php?module=ParsVT&parent=Settings&view=LayoutEditor&fieldid="+jQuery(this).data("field-id");app.request.get({url:t}).then((function(e,t){null===e?app.helper.showModal(t):app.helper.showErrorNotification({message:e.message})}))})),jQuery(".editFieldsTable",t).on("dblclick",(function(e){e.stopPropagation();var t="index.php?module=ParsVT&parent=Settings&view=LayoutEditor&blockid="+jQuery(this).data("block-id");app.request.get({url:t}).then((function(e,t){null===e?app.helper.showModal(t):app.helper.showErrorNotification({message:e.message})}))}))},registerTranslate:function(){jQuery(document).on("click",".modalTranslateSaveButton",(function(){var e=jQuery("#langVariable"),t=jQuery("#langTranslation");if(0==e.val().length)$(".langVariableVal")[0]||e.after('<span class="langVariableVal text-danger">'+app.vtranslate("JS_PLEASE_ENTER_VALID_VALUE")+"</span>"),e.focus();else{if(e.val().match(/[\<\>\,\;\:\\\\"\[\]\'\/\`\&]/))return e.after('<span class="langVariableVal text-danger">'+app.vtranslate("JS_CONTAINS_ILLEGAL_CHARACTERS")+"</span>"),e.focus(),!1;if(!/^([A-Za-z0-9\-\_\.\ ]*)?$/g.test(e.val()))return e.after('<span class="langVariableVal text-danger">'+app.vtranslate("JS_CONTAINS_ILLEGAL_CHARACTERS")+"</span>"),e.focus(),!1;if($(".langVariableVal").remove(),0==t.val().length)$(".langTranslationVal")[0]||t.after('<span class="langTranslationVal text-danger">'+app.vtranslate("JS_PLEASE_ENTER_VALID_VALUE")+"</span>"),t.focus();else{$(".langTranslationVal").remove();var a=jQuery("#newTranslateForm").serializeFormData(),r=jQuery.progressIndicator({message:"",position:"html",blockInfo:{enabled:!0}}),n={module:"ParsVT",action:"ActionAjax",mode:"SaveLayoutEditor"};n.data=a,AppConnector.request(n).then((function(e){r.progressIndicator({mode:"hide"}),e.success?1==e.result.success?app.helper.showSuccessNotification({message:e.result.message}):app.helper.showErrorNotification({message:e.result.message}):app.helper.showErrorNotification({message:"Error"})}),(function(e){r.progressIndicator({mode:"hide"}),app.helper.showErrorNotification({message:"Error"})})),app.helper.hideModal(),setTimeout((function(){window.location.reload(1)}),3e3)}}}))},relatedTooltipTabClickEvent:function(){var e=this,t=jQuery("#layoutEditorContainer").find(".contents"),a=t.find("#tooltipContainer");t.find(".tooltipTab").click((function(){e.showRelatedTooltipTab(a)}))},showRelatedTooltipTab:function(e,t){var a=this;void 0===t&&(t={});var r={module:"ParsVT"};r.parent=app.getParentModuleName(),r.sourceModule=jQuery("#selectedModuleName").val(),r.view="TooltipManager",r.originModule=app.getModuleName(),r=jQuery.extend(r,t),app.helper.showProgress(),app.request.post({data:r}).then((function(t,r){app.helper.hideProgress(),null===t&&(e.html(r),$("#list_fields").select2(),$("#preview_type").select2(),$("#list_fields.select2").on("change",(function(t){$("option:selected",this);a.showRelatedTooltipTab(e,{selected_field:this.value})})))}))},registerLayoutEditorTooltip:function(e){$("ul.layoutTabs").append('<li class="tooltipTab"><a data-toggle="tab" href="#tooltipContainer" data-url="index.php?module=LayoutEditor&parent=Settings&view=Index" data-mode="showTooltipManager" aria-expanded="true"><strong>'+e+"</strong></a></li>"),$("div.tab-content.layoutContent").append('<div class="tab-pane" id="tooltipContainer"></div>'),this.relatedTooltipTabClickEvent()},registerLayoutEditor:function(){var e=this;"LayoutEditor"==app.getModuleName()&&"Settings"==app.getParentModuleName()&&(jQuery("#layoutEditorContainer").length>0&&(e.initLayoutEditor(),e.registerTranslate(),jQuery("#layoutEditorContainer").on("change",'[name="layoutEditorModules"]',(function(t){setInterval((function(){0==jQuery(".translateNotification").length&&(e.initLayoutEditor(),e.registerTranslate())}),2e3)}))))},removeToolbar:function(){$(document).on("click","#CloseLicenseToolbar",(function(){jQuery("#LicenseToolbar").fadeOut("slow",(function(){app.storage.set("ParsVT_Toolbar",Math.round((new Date).getTime()/1e3))})),$("#page").css("padding-top",84)}))},ConvertTimeformat:function(e){format="24";var t=Number(e.match(/^(\d+)/)[1]),a=Number(e.match(/:(\d+)/)[1]),r=e.match(/\s(.*)$/);if(void 0===typeof r||null===r)return e;"PM"==(r=r[1])&&t<12&&(t+=12),"AM"==r&&12==t&&(t-=12);var n=t.toString(),i=a.toString();return t<10&&(n="0"+n),a<10&&(i="0"+i),n+":"+i},registerValidators:function(){var e=this,t=app.getDateFormat();if(void 0===(a=jQuery("body").data("calendar")))var a="undefined";var i="en";"jalali"==a?i="fa":"islamic"==a&&(i="ar");jQuery("body").data("language");"en"!=i&&(jQuery.validator.addMethod("date",(function(e,a,r){return!(""!=e&&e&&0!==e.length&&!/^\s*$/.test(e))||(e=vtfarsitools.getDateInstance(e,t),this.optional(a)||/^([12]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01]))$/.test(e))}),jQuery.validator.format(app.vtranslate("Please enter the correct date"))),jQuery.validator.addMethod("Calendar_greaterThanDependentField",(function(t,a,r){var n=!0,o=jQuery(a).closest("form"),s=o.find('[name="date_start"]'),l=o.find('[name="time_start"]'),d=o.find('[name="due_date"]'),p=o.find('[name="time_end"]'),u=app.getDateFormat(),c=app.getHourFormat(),g="HH:mm";12===c&&(g="hh:mm A");var v=s.val(),f=d.val(),h="00:00",m="23:59";if(12===c&&(h="12:00 AM",m="11:59 PM"),l.length&&(h=l.val()),p.length&&(m=p.val()),"en"!=i){v=vtfarsitools.getDateInstance(v,u),f=vtfarsitools.getDateInstance(f,u);var b=v+" "+e.ConvertTimeformat(h),y=f+" "+e.ConvertTimeformat(m);n=(b=new Date(b))<=(y=new Date(y))}else{var w=u.toUpperCase()+" "+g;b=moment(v+" "+h,w),y=moment(f+" "+m,w);n=b.unix()<y.unix()}return n}),jQuery.validator.format(app.vtranslate("JS_CHECK_START_AND_END_DATE_SHOULD_BE_GREATER"))),jQuery.validator.addMethod("lessThanDependentField",(function(e,t,a){var r=!0;if(!e.length)return r;var n=this.settings.validationMeta;if(void 0!==n)var o=n;else if("undefined"!=typeof uimeta)o=uimeta;else o=quickcreate_uimeta;var s=jQuery(t),l=o.field.get(s.attr("name")),d=a[0],p=o.field.get(d);if(void 0===l||void 0===p)return r;if("date"!==l.type||"date"!==p.type)return r;var u=s.closest("form.recordEditView").first(),c=app.getDateFormat();if(u.length>0)var g=u.find('[name="'+d+'"]').val();else{app.controller();if(g=jQuery(".fieldBasicData").filter('[data-name="'+d+'"]').data("displayvalue"))4==g.split("-")[0].length&&(c="yyyy-mm-dd")}if(void 0===g||""==g)return r;var v=app.getDateFormat();if("en"!=i){r=(f=e=vtfarsitools.getDateInstance(e,v,!0))<=(h=g=vtfarsitools.getDateInstance(g,v,!0))}else{var f=moment(e,v.toUpperCase()),h=moment(g,c.toUpperCase());r=f.unix()<=h.unix()}return jQuery.validator.messages.lessThanDependentField=l.label+" "+app.vtranslate("JS_SHOULD_BE_LESS_THAN_OR_EQUAL_TO")+" "+p.label,r}),jQuery.validator.format(app.vtranslate("Please enter the correct date"))),jQuery.validator.addMethod("greaterThanDependentField",(function(e,t,a){var r=!0;if(!e.length)return r;var n=this.settings.validationMeta;if(void 0!==n)var o=n;else if("undefined"!=typeof uimeta)o=uimeta;else o=quickcreate_uimeta;var s=jQuery(t),l=o.field.get(s.attr("name")),d=a[0],p=o.field.get(d);if(void 0===l||void 0===p)return r;if(!("date"===l.type&&"date"===p.type||"datetime"===l.type&&"datetime"===p.type))return console.log("greaterThanDependentField() validation method should be used for date fields only"),r;if(s.closest("form.recordEditView").length>0)var u=s.closest("form.recordEditView").first();else u=s.closest("form#detailView");if(u.length>0){if(void 0===(c=u.find('[name="'+d+'"]').val())){app.controller();c=jQuery(".fieldBasicData").filter('[data-name="'+d+'"]').data("displayvalue")}}else var c=app.controller().getFieldValue(d,s);if(void 0===c)return r;if(c.trim().length<=0)return!0;var g=app.getDateFormat();if("en"!=i){r=(v=e=vtfarsitools.getDateInstance(e,g,!0))>=(f=c=vtfarsitools.getDateInstance(c,g,!0))}else{var v=moment(e,g.toUpperCase()),f=moment(c,depFieldDateFormat.toUpperCase());r=v.unix()>=f.unix()}return jQuery.validator.messages.greaterThanDependentField=l.label+" "+app.vtranslate("JS_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO")+" "+p.label,r}),jQuery.validator.format(app.vtranslate("JS_PLEASE_ENTER_VALID_VALUE"))),jQuery.validator.addMethod("lessThanToday",(function(e,a,r){try{if(e){if("en"!=i)(n=vtfarsitools.getDateInstance(e,t,!0)).setHours(0,0,0,0);else{var n=app.helper.getDateInstance(e,app.getDateFormat());n.setHours(0,0,0,0)}var o=new Date;if(o.setHours(0,0,0,0),o-n<=0)return!1}return!0}catch(e){return!1}}),(function(e,t){return app.vtranslate("JS_SHOULD_BE_LESS_THAN_CURRENT_DATE")})),jQuery.validator.addMethod("lessThanOrEqualToToday",(function(e,a,r){try{if(e){"en"!=i&&(e=vtfarsitools.getDateInstance(e,t));var n=app.helper.getDateInstance(e,app.getDateFormat());n.setHours(0,0,0,0);var o=new Date;if(o.setHours(0,0,0,0),o-n<0)return!1}return!0}catch(e){return!1}}),(function(e,t){return app.vtranslate("JS_SHOULD_BE_LESS_THAN_OR_EQUAL_TO")+" "+app.vtranslate("JS_CURRENT_DATE")})),jQuery.validator.addMethod("greaterThanOrEqualToToday",(function(e,a,r){try{if(e){"en"!=i&&(e=vtfarsitools.getDateInstance(e,t));var n=app.helper.getDateInstance(e,app.getDateFormat());n.setHours(0,0,0,0);var o=new Date;if(o.setHours(0,0,0,0),n-o<0)return!1}return!0}catch(e){return!1}}),(function(e,t){return app.vtranslate("JS_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO")+" "+app.vtranslate("JS_CURRENT_DATE")})),jQuery.validator.addMethod("futureEventCannotBeHeld",(function(t,a,r){try{if("Held"==t)for(var n=jQuery(a).closest("form"),o=0;o<r.length;o++){var s=r[o],l=jQuery("input[name="+s+"]",n);if(l.length>0){var d=new Date,p=l.data("date-format"),u=jQuery("input[name=time_start]",n),c=l.val()+" "+u.val(),g=app.helper.getDateInstance(c,p);if("en"!=i){p=app.getDateFormat(),c=l.val();t=(t=vtfarsitools.getDateInstance(c,p))+" "+e.ConvertTimeformat(u.val());var v=new Date(t);return result=v<=d,result}if(d-g<0)return!1}}return!0}catch(e){return console.log(e),!1}}),jQuery.validator.format(app.vtranslate("JS_FUTURE_EVENT_CANNOT_BE_HELD"))),jQuery.validator.addMethod("greaterThanDependentRepeatTillDate",(function(e,t,a){var r=jQuery(t).closest("form");if(!r.find('input[name="recurringcheck"]').is(":checked")||!jQuery(t).hasClass("dateField"))return!0;var n=r.find('[name="date_start"]'),o=r.find('[name="calendar_repeat_limit_date"]'),s=app.getDateFormat(),l=n.val(),d=o.val(),p=s.toUpperCase();if("en"!=i){e=vtfarsitools.getDateInstance(l,s,!0),depFieldVal=vtfarsitools.getDateInstance(d,s,!0);var u=e;return depFieldVal>=u}u=moment(l,p);return moment(d,p).unix()>=u.unix()}),jQuery.validator.format(app.vtranslate("JS_REPEAT_DATE_SHOULD_BE_GREATER_THAN_START_DATE")))),jQuery.validator.addMethod("nationalcode",(function(e,t){c=parseInt(e.charAt(9)),n=10*parseInt(e.charAt(0))+9*parseInt(e.charAt(1))+8*parseInt(e.charAt(2))+7*parseInt(e.charAt(3))+6*parseInt(e.charAt(4))+5*parseInt(e.charAt(5))+4*parseInt(e.charAt(6))+3*parseInt(e.charAt(7))+2*parseInt(e.charAt(8)),r=n-11*parseInt(n/11);var a=!0;return"10"!=e.length&&(a=!1),"1111111111"!=e&&"0000000000"!=e&&"2222222222"!=e&&"3333333333"!=e&&"4444444444"!=e&&"5555555555"!=e&&"6666666666"!=e&&"7777777777"!=e&&"8888888888"!=e&&"9999999999"!=e||(a=!1),this.optional(t)||a&&(0==r&&r==c||1==r&&1==c||r>1&&c==11-r)}),app.vtranslate("Please enter a valid Iranian National ID Number")),jQuery.validator.addMethod("legalnationalcode",(function(e,t){var a=!0;if((e.length<11||0==parseInt(e,10))&&(a=!1),0==parseInt(e.substr(3,6),10)&&(a=!1),a){for(var r=parseInt(e.substr(10,1),10),n=parseInt(e.substr(9,1),10)+2,i=new Array(29,27,23,19,17),o=0,s=0;s<10;s++)o+=(n+parseInt(e.substr(s,1),10))*i[s%5];10==(o%=11)&&(o=0),a=r==o}return this.optional(t)||a}),app.vtranslate("Please enter a valid Iranian Legal National Code Number")),jQuery.validator.addMethod("iranianmobile",(function(e,t){return this.optional(t)||/^(0|0098|\+98)9\d{9}$/.test(e)}),app.vtranslate("Please enter a valid Iranian Mobile Number")+"\n (+989123456789 / 09123456789)"),jQuery.validator.addMethod("pwd",(function(e,t){return this.optional(t)||/[0-9a-zA-Z*#+\s\w-~]*$/.test(e)}),app.vtranslate("Please enter a valid password")),jQuery.validator.addMethod("ip2location",(function(e,t){return this.optional(t)||/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(e)}),app.vtranslate("Please enter a valid IP Address")),jQuery.validator.addMethod("ParsVTDate",(function(e,t){return this.optional(t)||/^([12]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01]))/.test(e)}),app.vtranslate("JS_PLEASE_ENTER_VALID_DATE")),jQuery.validator.addMethod("IBAN",(function(t,a){return this.optional(a)||e.validateISO7064Checksum(t)}),app.vtranslate("Please Enter Valid IBAN Code")),jQuery.validator.addMethod("CCN",(function(e,t){var a=[{rule:/^603799\d{10}/g},{rule:/^589210\d{10}/g},{rule:/^627648\d{10}/g},{rule:/^627961\d{10}/g},{rule:/^603770\d{10}/g},{rule:/^628023\d{10}/g},{rule:/^628023\d{10}/g},{rule:/^502908\d{10}/g},{rule:/^627412\d{10}/g},{rule:/^622106\d{10}/g},{rule:/^639347\d{10}/g},{rule:/^502229\d{10}/g},{rule:/^627488\d{10}/g},{rule:/^621986\d{10}/g},{rule:/^639346\d{10}/g},{rule:/^639607\d{10}/g},{rule:/^636214\d{10}/g},{rule:/^502806\d{10}/g},{rule:/^502938\d{10}/g},{rule:/^603769\d{10}/g},{rule:/^610433\d{10}/g},{rule:/^627353\d{10}/g},{rule:/^589463\d{10}/g},{rule:/^627381\d{10}/g},{rule:/^504172\d{10}/g},{rule:/^636949\d{10}/g},{rule:/^505416\d{10}/g},{rule:/^606373\d{10}/g},{rule:/^628157\d{10}/g},{rule:/^639599\d{10}/g},{rule:/^585983\d{10}/g},{rule:/^505785\d{10}/g}];if(this.optional(t)||/^\d{4}-?\d{4}-?\d{4}-?\d{4}$/.test(e)){ccnvalue=e.replace(/[^0-9.]/g,"");for(var r=0;r<a.length;r++)if(a[r].rule.test(ccnvalue))return ParsVTCustomFields_Js.CheckCardDigits(ccnvalue);return!0}return!1}),app.vtranslate("Please Enter Valid Credit Card Number")),jQuery.validator.addMethod("irpostalcode",(function(e,t){return this.optional(t)||/^(?!(\d)\1{3})[13-9]{4}[1346-9][0-9]{5}$/.test(e)}),app.vtranslate("Please Enter Valid Postal Code")),jQuery.validator.addMethod("iranvatid",(function(e,t){var a=!1;if(a=!1,11==e.length){if(a=!0,(e.length<11||0==parseInt(e,10))&&(a=!1),0==parseInt(e.substr(3,6),10)&&(a=!1),a){for(var r=parseInt(e.substr(10,1),10),n=parseInt(e.substr(9,1),10)+2,i=new Array(29,27,23,19,17),o=0,s=0;s<10;s++)o+=(n+parseInt(e.substr(s,1),10))*i[s%5];10==(o%=11)&&(o=0),a=r==o}}else if(e.indexOf("0")>-1||e.indexOf("2")>-1)a=!1;else if(12==e.length){a=[11,15,18,33,36,39,44,47,51,55,58,63,66,69,74,77,81,85,88,93,96,99,13,16,19,34,37,41,45,48,53,56,59,64,67,71,75,78,83,86,89,94,97,14,17,31,35,43,49,54,57,65,68,73,76,79,84,87,91,95,98][Math.round(11*parseFloat(e.substr(0,1))+13*parseFloat(e.substr(1,1))+17*parseFloat(e.substr(2,1))+19*parseFloat(e.substr(3,1))+23*parseFloat(e.substr(4,1))+29*parseFloat(e.substr(5,1))+31*parseFloat(e.substr(6,1))+37*parseFloat(e.substr(7,1))+41*parseFloat(e.substr(8,1))+43*parseFloat(e.substr(9,1)))%61|0]==parseFloat(e.substr(10,2))}return this.optional(t)||a}),app.vtranslate("Please Enter Valid VAT ID")),jQuery.validator.addMethod("taxfilenumber",(function(e,t){var a=!1;12!==e.length?a=!1:a=Math.round(13*parseFloat(e.substr(0,1))+11*parseFloat(e.substr(2,1))+9*parseFloat(e.substr(3,1))+6*parseFloat(e.substr(4,1))+7*parseFloat(e.substr(5,1))+6*parseFloat(e.substr(6,1))+5*parseFloat(e.substr(7,1))+9*parseFloat(e.substr(8,1))+3*parseFloat(e.substr(9,1))+2*parseFloat(e.substr(10,1)))%11==parseFloat(e.substr(11,1));return this.optional(t)||a}),app.vtranslate("Please Enter Valid Tax File Number")),jQuery.validator.addMethod("barcode",(function(e,t){return this.optional(t)||/^([a-zA-Z0-9_\-\.]+)$/.test(e)}),app.vtranslate("Please Enter Valid Barcode Number"))},responsiveMode:function(){document.body.clientWidth<800&&($("div#MARKETING_modules_dropdownMenu").attr("data-default-url",""),$("div#SALES_modules_dropdownMenu").attr("data-default-url",""),$("div#INVENTORY_modules_dropdownMenu").attr("data-default-url",""),$("div#SUPPORT_modules_dropdownMenu").attr("data-default-url",""),$("div#PROJECT_modules_dropdownMenu").attr("data-default-url",""),$("div#TOOLS_modules_dropdownMenu").attr("data-default-url",""),$(".app-modules-dropdown-container .dropdown-backdrop").css("display","none")),$(document).ready((function(){$(window).resize((function(){$("#page").css("padding-top",$("#page>nav").height()+"px")})),setTimeout((function(){$("#page").css("padding-top",$("#page>nav").height()+"px")}),1e3)}))},validateISO7064Checksum:function(e){var t=function(e){var t=parseInt(e,10)%97;return 1===(t=t.toString()).length?"0"+t:t};if(e){for(e=function(e){for(var t=e.split(""),a=0;a<t.length;a++)/[A-Z]/.test(t[a])&&(t[a]=t[a].charCodeAt(0)-55);return t.join("")}(e=e.substr(4)+e.substr(0,4));e.length>2&&!isNaN(e);)e=t(e.substr(0,9))+e.substr(9);if(1===parseInt(e,10))return!0}return!1},initialization:function(){var e=this,t=app.storage.get("ParsVTMode"),a=app.storage.get("ParsVTTime"),r=app.storage.get("ParsVTSettingsLogs"),n=Math.round((new Date).getTime()/1e3);if(null===t||null===a||1!=t.length||n>a+3600){var i={action:"ActionAjax",module:"ParsVT",mode:"initialization"};app.request.post({data:i}).then((function(t,a){if(null==t)if(a&&a.result)a.t&&a.l?(e.manageSettingsLogs(),app.storage.set("ParsVTSettingsLogs","true")):app.storage.delete("ParsVTSettingsLogs"),a.t&&"B"!=a.t&&(e.registerSettingsBtn(),e.responsiveMode(),e.SwitchDirection(),e.FormatInventoryNumbers(),e.registerStartParsVT()),a.t&&"F"==a.t?(e.checkPermissionForAdhan(),e.registerLayoutEditor(),e.registerValidators(),app.storage.set("ParsVTMode","F")):a.t&&"C"==a.t?(e.registerValidators(),e.checkPermissionForAdhan(),app.storage.set("ParsVTMode","C")):app.storage.set("ParsVTMode","B"),app.storage.set("ParsVTTime",Math.round((new Date).getTime()/1e3));else if(a&&a.errors&&a.links)if(a.rlink[0])if("Settings"==app.getParentModuleName()){var r=app.storage.get("ParsVT_Toolbar"),n=Math.round((new Date).getTime()/1e3);(null===r||n>r+600)&&e.registerTopMenu(a.errors,a.links)}else app.helper.showProgress(),window.location=a.rlink[1];else app.helper.showProgress(),window.location=a.rlink[1]}),(function(e,t){}))}else"B"!=t&&(e.registerSettingsBtn(),e.responsiveMode(),e.SwitchDirection(),e.FormatInventoryNumbers(),e.registerStartParsVT()),"F"==t?(e.checkPermissionForAdhan(),e.registerLayoutEditor(),e.registerValidators()):"C"==t&&(e.registerValidators(),e.checkPermissionForAdhan()),"true"===r&&e.manageSettingsLogs()},isUnicode:function(e){for(var t=!1,a=0,r=e.length;a<r;a++)this.isPersian(e[a])&&e.charCodeAt(a)>255&&(t=!0);return t},isPersian:function(e){return!!/^[\u0600-\u06FF\s]+$/.test(e)},SwitchDirection:function(){var e=this;$("body").on("keyup","input[type=text],textarea",(function(t){e.isUnicode(t.currentTarget.value)?($(t.currentTarget).css("direction","rtl"),$(t.currentTarget).css("text-align","right")):($(t.currentTarget).css("direction","ltr"),$(t.currentTarget).css("text-align","left"))}))},FormatInventoryNumbers:function(){var e=this;"Invoice"!=app.getModuleName()&&"Quotes"!=app.getModuleName()&&"SalesOrder"!=app.getModuleName()&&"PurchaseOrder"!=app.getModuleName()||"Edit"!=app.view()||$((function(){$(document).on("change keyup",".qty",(function(){var t=e.addCommas($(this).val());0==$(this).parent().find("span.qty_separator").length?$(this).after('<br><span style="color: #959595;" class="qty_separator">'+t+"</span>"):$(this).parent().find("span.qty_separator").html(t)})),$(document).on("change keyup",".listPrice",(function(){var t=e.addCommas($(this).val());0==$(this).parent().parent().find("span.listPrice_separator").length?$(this).parent().after('<br><span style="color: #959595;" class="listPrice_separator">'+t+"</span>"):$(this).parent().parent().find("span.listPrice_separator").html(t)}))}))},addCommas:function(e){for(var t=(e+="").split("."),a=t[0],r=t.length>1?"."+t[1]:"",n=/(\d+)(\d{3})/;n.test(a);)a=a.replace(n,"$1,$2");return a+r},showInventorySave:function(){if(InventoryModulesNames.includes(app.getModuleName())){$(".saveButton").removeClass("hide");var e=0,t=setInterval((function(){20!==(e+=1)&&$(".saveButton").hasClass("hide")||clearInterval(t),$(".saveButton").removeClass("hide")}),2e3);$("#EditView .saveButton").click((function(){jQuery("#EditView").valid()&&0===jQuery("#EditView").validate().pendingRequest&&jQuery(".saveButton").addClass("hide")}))}},manageXHRRequest:function(){setTimeout((function(){window.ajaxEnabled=!0,setInterval((function(){$.ajaxSetup({beforeSend:function(){return document.hidden?window.ajaxEnabled=!1:window.ajaxEnabled=!0,window.ajaxEnabled}})}),500)}),15e3)},registerRemoveWhiteSpace:function(){"Detail"!=app.view()&&"PreferenceDetail"!=app.view()||$(".fieldValue span.value, .fieldLabel span.muted").each((function(){$(this).html($(this).html().replace(/&nbsp;/gi,""))}))},registerSettingsSideBarSearch:function(){"Settings"==app.getParentModuleName()&&(window.hasOwnProperty("Settings_Vtiger_Index_Js")&&(new Settings_Vtiger_Index_Js).registerBasicSettingsEvents())},registerProfilePreferences:function(){"Users"==app.getModuleName()&&"Settings"==app.getParentModuleName()&&"PreferenceDetail"==app.view()&&$("#imageContainer > img").css({width:"250px",height:"250px"}),"Contacts"==app.getModuleName()&&"Detail"==app.view()&&$("#imageContainer > li > img").css({width:"250px",height:"250px"}),"Products"==app.getModuleName()&&"Detail"==app.view()&&$("#imageContainer > li > img").css({width:"250px",height:"250px"}),"Users"==app.getModuleName()&&"Settings"==app.getParentModuleName()&&"PreferenceEdit"==app.view()&&$("span > img").css({width:"250px",height:"250px"}),"Contacts"==app.getModuleName()&&"Edit"==app.view()&&$("span > img").css({width:"250px",height:"250px"}),"Products"==app.getModuleName()&&"Edit"==app.view()&&$("span > img").css({width:"250px",height:"250px"})},getQueryParams:function(e){if(void 0!==e){e=e.toString().split("+").join(" ");for(var t,a={},r=/[?&]?([^=]+)=([^&]*)/g;t=r.exec(e);)a[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return a}},searchValue:function(e,t){let a=!1;return $.each(e,(function(e,r){if(t.includes(r))return a=!0,!0})),a},manageSettingsLogs:function(){var e=this;if("Settings"==app.getParentModuleName()){var t=["save","edit","delete","create","update","add","persianpack"],a=["savesettingslog"],r=["save","edit","delete","create","update","add"],n=["editview","checkmacrosissaved"],i=["GPTIntegration","Workflows","ControlLayoutFields"];jQuery(document).ajaxComplete((function(i,o,s){if(void 0!==s.data){let i=e.getQueryParams(s.data);if("POST"===s.type&&(void 0!==i.action&&!e.searchValue(a,i.action.toLowerCase())&&e.searchValue(t,i.action.toLowerCase())||void 0!==i.mode&&!e.searchValue(n,i.mode.toLowerCase())&&e.searchValue(r,i.mode.toLowerCase()))){var l={module:"ParsVT",action:"Tracker",uri:$(location).attr("href"),predata:s.data,postdata:o.responseText};app.request.post({data:l})}}})),$("body").on("click",'form:not([workflow_edit]) button[type="submit"]',(function(t){if(0===$(this).parents(".modal").length&&0===$(this).parents(".gptintegrationconfigurationEdit1").length){let o=$(this).parents("form:first");var a=o.serializeArray(),r={};if($.map(a,(function(e,t){r[e.name]=e.value})),void 0!==typeof r.module&&r.module&&!e.searchValue(i,r.module)){t.preventDefault();var n={module:"ParsVT",action:"Tracker",uri:$(location).attr("href"),predata:r,postdata:null};app.request.post({data:n}),o.unbind("submit").submit()}}}))}},registerManifestJson:function(){$("head").append('<link rel="manifest" href="modules/ParsVT/manifest.json">')},registerServiceWorker:function(){var e=window.location.pathname,t=e.substring(0,e.lastIndexOf("/")+1);(async()=>{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register(t+"sw.js",{scope:t});e.installing||e.waiting||e.active}catch(e){console.dir("Registration failed with "+e)}})()},triggerTransferOwnership:function(e){var t=app.convertUrlToDataParams(e);app.helper.showProgress(),app.request.post({data:t}).then((function(e,t){app.helper.hideProgress(),app.helper.showModal(t);var a=jQuery("form#parsvtChangeOwner");a.length&&Vtiger_ParsVT_Js.transferOwnershipSave(a)}))},transferOwnershipSave:function(e){e.on("click","button[name='saveButton']",(function(t){t.preventDefault();var a={related_modules:{required:!0},transferOwnerId:{required:!0}},r={rules:a,submitHandler:function(e){if(jQuery(e).find("button[name='saveButton']").attr("disabled","disabled"),this.numberOfInvalids()>0)return!1;var t=jQuery("#transferOwnerId").val(),a=jQuery("#related_modules").val(),r=jQuery("#recordId").val(),n={module:"ParsVT",source_module:app.getModuleName(),action:"TransferOwnership",record:r,transferOwnerId:t,related_modules:a};app.request.post({data:n}).then((function(e,t){null===e&&(app.helper.hideModal(),app.helper.showAlertBox({message:app.vtranslate("JS_RECORDS_TRANSFERRED_SUCCESSFULLY")}))}))}};validateAndSubmitForm(e,r)}))},registerEvents:function(){var e=this,t=this;e.removeToolbar(),e.initialization(),e.showInventorySave(),e.manageXHRRequest(),e.registerRemoveWhiteSpace(),e.registerProfilePreferences(),e.registerSettingsSideBarSearch(),e.registerServiceWorker(),e.registerManifestJson(),"Detail"==app.getViewName()&&jQuery(document).ajaxComplete((function(a,r,n){var i=n.data;void 0===i&&n.url&&(i=n.url);var o=t.getQueryParams(i);void 0!==o&&"Detail"==o.view&&"showDetailViewByMode"==o.mode&&(e.registerRemoveWhiteSpace(),e.registerProfilePreferences())}))}};jQuery(document).ready((function(){Vtiger_ParsVT_Js.registerEvents()}));
