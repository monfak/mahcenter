/* ********************************************************************************
 * The content of this file is subject to the ParsVT.com Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is ParsVT.com
 * Portions created by ParsVT.com. are Copyright(C) ParsVT Team
 * All Rights Reserved.
 * ****************************************************************************** */
Vtiger_List_Js("ParsVT_KanbanView_Js",{_sprintf:function(e){const a=RegExp("%s","g");let t,i=1;for(;null!==(t=a.exec(e));){let r=arguments[i];if(!r)break;{let n=e.split("");n.splice(t.index,a.lastIndex-t.index,r),e=n.join(""),i++}}return e},getParameterByName:function(e,a=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(a);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null},markAsHeld:function(e,a,t,i){app.helper.showConfirmationBox({message:app.vtranslate("JS_CONFIRM_MARK_AS_HELD")}).then((function(){var r={module:"Calendar",action:"SaveFollowupAjax",mode:"markAsHeldCompleted",record:e};app.request.post({data:r}).then((function(r,n){if(r)app.helper.showErrorNotification({message:app.vtranslate("JS_PERMISSION_DENIED")});else if(n&&!0===n.valid&&!0===n.markedascompleted){jQuery(".kanbanactivityid"+e).hide();var s={};s.record=t,s.action="KanbanGridAjax",s.module="ParsVT",s.source_module=a,s.mode="getActivities",app.request.post({data:s}).then((function(e,a){if(null==e){var t=JSON.parse(a),r=jQuery(i).parent().closest(".kbBoxTask");r.find("div.container-fluid.kbTaskFooter > div:nth-child(1) > div").html(t.result),r.find("img.kanban_activity_status").attr("src","layouts/v7/modules/ParsVT/resources/Kanban/img/"+t.image),r.find("img.kanban_activity_status").attr("data-original-title",t.title),r.find("img.kanban_activity_status").attr("data-title",t.title)}}))}else app.helper.showAlertNotification({message:app.vtranslate("JS_FUTURE_EVENT_CANNOT_BE_MARKED_AS_HELD")})}))}))}},{registerQuickEditEvent:function(){var e=new Vtiger_Index_Js;jQuery(".kbQuickEdit").on("click",(function(a){var t=jQuery(this).closest(".kbBoxTask"),i=jQuery(this).data("url");app.request.post({url:i}).then((function(a,i){app.helper.hideProgress();var r={cb:function(a){e.registerPostReferenceEvent(a),app.event.trigger("post.QuickCreateForm.show",n),app.helper.registerLeavePageWithoutSubmit(n),app.helper.registerModalDismissWithoutSubmit(n)},backdrop:"static",keyboard:!1};app.helper.showModal(i,r);var n=jQuery('form[name="QuickCreate"]'),s=n.find('[name="module"]').val();app.helper.showVerticalScroll(jQuery('form[name="QuickCreate"] .modal-body'),{autoHideScrollbar:!0});var o=new Vtiger_Index_Js,l=Vtiger_Edit_Js.getInstanceByModuleName(s);"function"==typeof l.quickCreateSave&&(o=l).registerBasicEvents(n),vtUtils.applyFieldElementsView(n);o.quickCreateSave(n,{callbackFunction:function(e,a){null==a&&(jQuery(".kbTaskTitle a",t).html(e._recordLabel),jQuery.each(e,(function(e,a){if("_recordId"!=e&&"_recordLabel"!=e){var i=jQuery('.fieldValue[data-field-name="'+e+'"]',t);i.length>0&&(jQuery(".value",i).attr("title",a.display_value),jQuery(".value",i).html(a.display_value),jQuery(".fieldBasicData",i).data("displayvalue",a.display_value),jQuery(".fieldBasicData",i).data("value",a.value)),"kanban_color"==e&&t.css("background",a.value)}})))}}),app.helper.hideProgress()}))}))},registerScrollbar:function(){$(".kbBoxContent");$(".wmd-view-topscroll").scroll((function(){$(".wmd-view").scrollLeft($(".wmd-view-topscroll").scrollLeft())})),$(".wmd-view").scroll((function(){$(".wmd-view-topscroll").scrollLeft($(".wmd-view").scrollLeft())}))},registerEventToShowQuickKanbanPreview:function(){var e=this;jQuery(".kbTaskFooter").on("click",".quickKanbanView",(function(a){var t=jQuery(a.currentTarget),i=t.data("app"),r=t.data("id"),n=t.data("module");e.showQuickPreviewForId(r,n,i)}))},showQuickPreviewForId:function(e,a,t){Vtiger_Index_Js.getInstance().showQuickPreviewForId(e,a,t)},registerSortableEvent:function(){var e={};jQuery(".kbBoxContent").sortable({connectWith:".kbBoxContent",handle:".kbTaskHeader",cursor:"move",start:function(a,t){var i=t.item;e.itemName=i.find(".kbTaskTitle a").text(),e.from=i.closest(".kanbanBox").find(".kbBoxTitle").text()},stop:function(a,t){var i=t.item,r=jQuery("#primaryFieldName").val(),n=jQuery("#primaryFieldId").val(),s=i.find('input[name="recordId"]').val(),o=i.next(".kbBoxTask").find('input[name="recordId"]').val();void 0===o&&(o=-1);var l=i.prev(".kbBoxTask").find('input[name="recordId"]').val();void 0===l&&(l=-1);var d=i.closest(".kanbanBox").find('input[name="primaryValue"]').val;e.to=i.closest(".kanbanBox").find(".kbBoxTitle").text(),jQuery(".kanbanBox").each((function(){var e=jQuery(this);jQuery(this).find('input[name="recordId"]').each((function(){jQuery(this).val()==s&&(d=e.find('input[name="primaryValue"]').val())}))}));var u={primaryFieldName:r,primaryFieldId:n,recordId:s,nextRecordId:o,prevRecordId:l,primaryValue:d,module:"ParsVT",action:"KanbanGridAjax",mode:"updatePrimaryFieldValue",source_module:jQuery("#kbSourceModule").val()};app.request.post({data:u}).then((function(a){if(e.from!=e.to){if("fa_ir"==jQuery("body").data("language"))var t=ParsVT_KanbanView_Js._sprintf(app.vtranslate("%s updated from %s to %s"),e.itemName,e.from,e.to);else t=e.itemName+" updated from "+e.from+" to "+e.to;app.helper.showSuccessNotification({message:t})}}))}}).disableSelection()},fixWidthColumns:function(){var e=jQuery("#detailView .kbParentContainer .kanbanBox"),a=jQuery("#detailView .kbParentContainer").width();e.width((a-80)/4);jQuery("#detailView .kbParentContainer .kbContainer").width(e.length*(e.width()+20)),jQuery("#detailView .wmd-view-topscroll .scroll-div1").width(e.length*(e.width()+20))},registerAjaxEditEvent:function(){var e=this;jQuery(".kbParentContainer").on("click",".fieldValue .editAction",(function(a){if(0==window.getSelection().toString().length){var t=jQuery(a.currentTarget).closest(".kbValueContainer");e.ajaxEditHandling(t)}}))},fixWidthEditElement:function(e){e.width();jQuery(".editElement",e).css("min-width","initial")},ajaxEditHandling:function(e){var a=this,t=jQuery(".value",e),i=jQuery(".edit",e),r=jQuery(".fieldBasicData",i),n=r.data("name"),s=r.data("type"),o=r.data("displayvalue"),l=r.data("value");if(("disabled"!=jQuery('[name="'+n+'"]',i).attr("disabled")||"reference"==s)&&!(i.length<=0||i.is(":visible"))){if("multipicklist"===s){var d=n.split("[]");n=d[0]}if(-1!==jQuery.inArray(s,["owner","ownergroup","picklist","multipicklist","reference","currencyList","text"])&&(o=l),0===jQuery(".editElement",i).length){var u;(u=uimeta.field.get(n)).value=o;var c=Vtiger_Field_Js.getInstance(u).getUiTypeModel(),p=jQuery('<div class="input-group editElement"></div>');'<span class="pointerCursorOnHover input-group-addon input-group-addon-cancel inlineAjaxCancel"><i class="fa fa-close"></i></span>';var v=jQuery('<div class="input-save-wrap"></div>');v.append('<span class="pointerCursorOnHover input-group-addon input-group-addon-save inlineAjaxSave"><i class="fa fa-check"></i></span><span class="pointerCursorOnHover input-group-addon input-group-addon-cancel inlineAjaxCancel"><i class="fa fa-close"></i></span>'),p.append(c.getUi()).append(v),p.find(".inputElement").addClass("form-control"),i.append(p),a.fixWidthEditElement(e)}if("reference"===s&&0!==o){jQuery('input[name="'+n+'"]',i).prop("value",jQuery.trim(t.text()));var g=jQuery('input[name="'+n+'"]',i);g.attr("disabled")||(g.attr("disabled","disabled"),i.find(".clearReferenceSelection").removeClass("hide"))}t.css("display","none"),i.removeClass("hide").show().children().filter('input[type!="hidden"]input[type!="image"],select').filter(":first").focus(),vtUtils.applyFieldElementsView(e);var m=Vtiger_Index_Js.getInstance();if(m.registerAutoCompleteFields(e),m.referenceModulePopupRegisterEvent(e),i.addClass("ajaxEdited"),a.registerSaveOnEnterEvent(i),jQuery(".editAction").addClass("hide"),"picklist"==s||"ownergroup"==s||"owner"==s){var f=a.getDependentSourcePicklistName(n);f&&a.handlePickListDependencyMap(f)}}},getDependentSourcePicklistName:function(e){var a=jQuery("#detailView"),t=jQuery('[name="picklistDependency"]',a);if(t.length<=0)return"";var i=JSON.parse(t.val());if(Object.keys(i).length<=0)return"";var r="";return jQuery.each(i,(function(a,t){var i=t.__DEFAULT__;jQuery.each(i,(function(t,i){t==e&&(r=a)}))})),r},registerSaveOnEnterEvent:function(e){e.find(".inputElement:not(textarea)").on("keyup",(function(a){var t=e.find("textarea"),i=jQuery(a.target).closest(".ajaxEdited").find(".fieldBasicData").data("type");-1===["reference","picklist","multipicklist","owner"].indexOf(i)&&(t.length||13===(a.keyCode||a.which)&&e.find(".inlineAjaxSave").trigger("click"))}))},registerAjaxEditSaveEvent:function(e){var a=this;void 0===e&&(e=jQuery(".kbContainer")),e.on("click",".inlineAjaxSave",(function(t){t.preventDefault(),t.stopPropagation();var i=jQuery(t.currentTarget),r=i.closest(".kbValueContainer"),n=jQuery(".value",r),s=jQuery(".edit",r),o=jQuery(".editAction",r),l=jQuery(".fieldBasicData",s),d=l.data("name"),u=l.data("type"),c=jQuery.trim(l.data("displayvalue")),p=jQuery('[name="'+d+'"]',s),v=p.val(),g=r.closest(".kbBoxTask"),m=jQuery('[name="recordId"]',g).val();p.is("input:checkbox")?(v=p.is(":checked")?"1":"0",p=p.filter('[type="checkbox"]')):"reference"==u&&(v=p.attr("value"));if(-1!==jQuery.inArray(u,["owner","ownergroup","picklist","multipicklist","reference","boolean"])&&(c=l.data("value")),"multipicklist"===u){var f=d.split("[]");d=f[0]}var h=v;if(c==v)n.css("display","inline-block"),s.addClass("hide"),s.removeClass("ajaxEdited"),jQuery(".editAction").removeClass("hide"),o.show();else{var y={};y.value=h,y.field=d,y.record=m,y.module=jQuery("#kbSourceModule").val();var k=i.closest("form"),j={ignore:'span.hide .inputElement,input[type="hidden"]',submitHandler:function(t){var i=jQuery.Event(Vtiger_Detail_Js.PreAjaxSaveEvent);if(app.event.trigger(i,{form:jQuery(t),tiggeredFiledInfo:y}),i.isDefaultPrevented())return!1;jQuery(r).find(".input-group-addon").addClass("disabled"),app.helper.showProgress(),a.saveFieldValues(y).then((function(t){app.helper.hideProgress();var i=t;if("picklist"==l.data("type")&&"Users"!=app.getModuleName()){if(g=i[d].colormap[i[d].value])var u='<span class="picklist-color" style="background-color: '+g+"; color: "+("dark"===app.helper.getColorContrast(g)?"white":"black")+';">'+i[d].display_value+"</span>";else u='<span class="picklist-color">'+i[d].display_value+"</span>";n.html(u)}else if("multipicklist"==l.data("type")&&"Users"!=app.getModuleName()){u="";var c=i[d].value;c=c.split("|##|");var p=i[d].display_value;p=p.split(",");for(var v=0;v<c.length;v++){var g;if(g=i[d].colormap[c[v].trim()])u=u+'<span class="picklist-color" style="background-color: '+g+"; color: "+("dark"===app.helper.getColorContrast(g)?"white":"black")+';">'+p[v]+"</span>";else u=u+'<span class="picklist-color">'+p[v]+"</span>";void 0!==p[v+1]&&(u+=" , ")}n.html(u)}else"currency"==l.data("type")&&"Users"!=app.getModuleName()?(n.find(".currencyValue").html(i[d].display_value),e.closest(".detailViewContainer").find(".detailview-header-block").find("."+d).html(i[d].display_value)):(n.html(i[d].display_value),e.hasClass("overlayDetail")?e.find(".overlayDetailHeader").find("."+d).html(i[d].display_value):e.closest(".detailViewContainer").find(".detailview-header-block").find("."+d).html(i[d].display_value));l.data("displayvalue",i[d].display_value),l.data("value",i[d].value),jQuery(r).find(".input-group-addon").removeClass("disabled"),n.css("display","inline-block"),s.addClass("hide"),s.removeClass("ajaxEdited"),jQuery(".editAction").removeClass("hide"),o.show();var m=jQuery.Event(Vtiger_Detail_Js.PostAjaxSaveEvent);if(app.event.trigger(m,l,i,e),a.targetPicklistChange){var f=a.sourcePicklistname;a.targetPicklist.find(".editAction").trigger("click"),a.targetPicklistChange=!1,a.targetPicklist=!1,a.handlePickListDependencyMap(f),a.sourcePicklistname=!1}}))}};validateAndSubmitForm(k,j)}}))},handlePickListDependencyMap:function(e){var a=jQuery("#detailView"),t=jQuery('[name="picklistDependency"]',a);if(!(t.length<=0)){var i=JSON.parse(t.val());if(!(Object.keys(i).length<=0)){var r=i[e],n=r[a.find("[data-name="+e+"]").data("value")],s=r.__DEFAULT__;void 0===n&&(n=s),jQuery.each(s,(function(t,i){var r=n[t];void 0===r&&(r=i);var s=jQuery('[name="'+t+'"]',a);if(!(s.length<=0)){var o=s.data("available-options");void 0===o&&(o=jQuery("option",s),s.data("available-options",o));var l=new jQuery,d=[];d.push("");for(var u=0;u<r.length;u++)d.push(r[u]);jQuery.each(o,(function(e,a){var t=jQuery(a).val();-1!=jQuery.inArray(t,d)&&(l=l.add(jQuery(a)))}));var c="";if(c=l.filter("[selected]").val(),1==r.length&&(c=r[0]),("group_id"==t||"assigned_user_id"==t)&&""==jQuery("[data-name="+e+"]").data("value"))return!1;s.html(l).val(c).trigger("change")}}))}}},saveFieldValues:function(e){var a=jQuery.Deferred(),t={};return void 0!==e&&(t=e),t.action="SaveAjax",app.request.post({data:t}).then((function(e,t){null===e?(app.helper.showSuccessNotification({message:""}),a.resolve(t)):app.helper.showErrorNotification({message:e})})),a.promise()},registerAjaxEditCancelEvent:function(e){void 0===e&&(e=jQuery(".kbContainer")),e.on("click",".inlineAjaxCancel",(function(e){e.preventDefault(),e.stopPropagation();var a=jQuery(e.currentTarget).closest(".kbValueContainer"),t=jQuery(".value",a),i=jQuery(".edit",a),r=jQuery(".editAction",a);t.css("display","inline-block"),i.addClass("hide"),i.find(".inputElement").trigger("Vtiger.Validation.Hide.Messsage"),i.removeClass("ajaxEdited"),jQuery(".editAction").removeClass("hide"),r.show()}))},registerDeleteRecordClickEvent:function(){var e=this;jQuery("#page").on("click",".deleteKanbanRecordButton",(function(a){var t=jQuery(a.currentTarget),i=t.data("id"),r=t.data("viewname"),n=t.data("module");1===t.data("recurringEnabled")?app.helper.showConfirmationForRepeatEvents().then((function(a){e._deleteKanbanRecord(i,n,r,a)})):e.deleteKanbanRecord(i,n,r),a.stopPropagation()}))},_deleteKanbanRecord:function(e,a,t,i){var r={data:{module:a,action:"DeleteAjax",record:e,viewname:t}};void 0===i&&(i={}),jQuery.extend(r.data,i),app.helper.showProgress(),app.request.post(r).then((function(e,a){null==e?(app.helper.hideProgress(),jQuery(this).closest(".kbBoxTask").remove()):(app.helper.hideProgress(),app.helper.showErrorNotification({message:app.vtranslate(e.message)}),setTimeout((function(){window.location.reload()}),3e3))}))},deleteKanbanRecord:function(e,a,t){var i=this,r=app.vtranslate("LBL_DELETE_CONFIRMATION");app.helper.showConfirmationBox({message:r}).then((function(){i._deleteKanbanRecord(e,a,t)}))},registerStarToggle:function(){jQuery("#page").on("click",".markKanbanStar",(function(e){var a=jQuery(e.currentTarget);if(!a.hasClass("processing")){a.addClass("processing");var t={};t.module=a.data("module"),t.action="SaveStar",t.record=a.data("id"),a.hasClass("active")?(t.value=0,a.removeClass("fa-star").addClass("fa-star-o")):(t.value=1,a.removeClass("fa-star-o").addClass("fa-star")),a.toggleClass("active"),t._timeStampNoChangeMode=!0,app.request.post({data:t}).then((function(e,i){i&&(0==t.value?a.attr("title",app.vtranslate("JS_NOT_STARRED")):a.attr("title",app.vtranslate("JS_STARRED"))),a.removeClass("processing")})),a.hasClass("active")?app.helper.showSuccessNotification({message:app.vtranslate("JS_FOLLOW_RECORD")}):app.helper.showSuccessNotification({message:app.vtranslate("JS_UNFOLLOW_RECORD")})}}))},registerListEssentialsToggleEvent:function(){jQuery(".main-container").on("click",".essentials-toggle",(function(){contentContainer=jQuery("#detailView .kbParentContainer"),contentContainer.mCustomScrollbar("destroy"),app.helper.showHorizontalScroll(contentContainer,{})}))},registerChangeLinks:function(){var e=this;$(document).ready((function(){e.changeLinks("#page nav .app-nav div.module-breadcrumb.module-breadcrumb-List p  a","add"),$(document).on("click","#convertListLinks",(function(){$("#convertListLinks").is(":checked")?(e.changeLinks("#myList ul  li  a","add"),e.changeLinks("#sharedList ul  li  a","add")):(e.changeLinks("#myList ul  li  a","remove"),e.changeLinks("#sharedList ul  li  a","remove"))})),e.changeLinks("#myList ul  li  a","add"),e.changeLinks("#sharedList ul  li  a","add"),0==jQuery("#convertListLinks").length&&jQuery('<div class="sidebar-header clearfix"><h5 class="pull-left">'+CONVERTLINKSMSG.CONVERTLINKS+'</h5><input type="checkbox" id="convertListLinks"  checked style="margin-top: 10px" class="pull-right inputElement" /></div><hr>').insertBefore("#module-filters  div.sidebar-header")}))},changeLinks:function(e,a){jQuery(e).each((function(){var e=ParsVT_KanbanView_Js.getParameterByName("viewname",this.href);if("remove"==a){var t="index.php?module="+jQuery("#kbSourceModule").val()+"&view=List&parent="+app.getParentModuleName()+"&viewname="+e+"&app="+app.getAppName();this.href=t}else{t="index.php?module=ParsVT&view=KanbanView&parent="+app.getParentModuleName()+"&viewname="+e+"&source_module="+jQuery("#kbSourceModule").val()+"&app="+app.getAppName();this.href=t}}))},registerEventForActivity:function(){var e=this;jQuery(".createActivity").on("click",(function(a){var t,i=jQuery(a.currentTarget);t=i.hasClass("toDotask")?"Calendar":"Events";var r=jQuery("#quickCreateModules").find('[data-name="'+t+'"]'),n=i.data("id"),s=i.data("module");jQuery(a.currentTarget);r.length<=0&&app.helper.showErrorMessage(app.vtranslate("JS_NO_CREATE_OR_NOT_QUICK_CREATE_ENABLED"));var o=e.referenceFieldNames[s];void 0===o&&"Contacts"!=s&&(o="parent_id");var l={};l[o]=n,l.parentModule=s,app.event.on("post.QuickCreateForm.show",(function(e,a){jQuery('<input type="hidden" name="sourceModule" value="'+s+'" >').appendTo(a),jQuery('<input type="hidden" name="sourceRecord" value="'+n+'" >').appendTo(a),jQuery('<input type="hidden" name="relationOperation" value="true" >').appendTo(a),jQuery('<input type="hidden" name="'+o+'" value="'+n+'" >').appendTo(a)})),app.event.on("post.QuickCreateForm.save",(function(e,t){var i={};i.record=n,i.action="KanbanGridAjax",i.module="ParsVT",i.source_module=s,i.mode="getActivities",app.request.post({data:i}).then((function(e,t){if(null==e){var i=JSON.parse(t);jQuery(a.currentTarget).parent().closest(".kbBoxTask").find("div.container-fluid.kbTaskFooter > div:nth-child(1) > div").html(i.result),jQuery(a.currentTarget).parent().closest(".kbBoxTask").find("img.kanban_activity_status").attr("src","layouts/v7/modules/ParsVT/resources/Kanban/img/"+i.image),jQuery(a.currentTarget).parent().closest(".kbBoxTask").find("img.kanban_activity_status").attr("data-original-title",i.title),jQuery(a.currentTarget).parent().closest(".kbBoxTask").find("img.kanban_activity_status").attr("data-title",i.title)}}))}));var d={noCache:!1};d.data=l,r.trigger("click",d)}))},referenceFieldNames:{Accounts:"parent_id",Contacts:"contact_id",Leads:"parent_id",Potentials:"parent_id",HelpDesk:"parent_id",Project:"projectid"},showPagingInfo:function(){var e=this.getListViewContainer(),a=jQuery("#totalCount",e).val(),t=parseInt(jQuery("#pageStartRange",e).val()),i=parseInt(jQuery("#pageEndRange",e).val()),r=t+" "+app.vtranslate("to")+" "+i+" "+app.vtranslate("of")+" "+a+"  ";0!==parseInt(jQuery("#noOfEntries",e).val())?jQuery(".pageNumbersText",e).html(r):jQuery(".pageNumbersText",e).html("")},totalNumOfRecords_performingAsyncAction:!1,totalNumOfRecords:function(e){var a=this,t=a.getListViewContainer(),i=t.find("#totalCount"),r=i.val();a.totalNumOfRecords_performingAsyncAction||(e.find(".showTotalCountIcon").addClass("hide"),""===r?(a.totalNumOfRecords_performingAsyncAction=!0,a.getPageCount().then((function(n){e.addClass("hide"),r=n.numberOfRecords,i.val(r),t.find("ul#listViewPageJumpDropDown #totalPageCount").text(n.page),a.showPagingInfo(),a.totalNumOfRecords_performingAsyncAction=!1}))):(e.addClass("hide"),a.showPagingInfo()))},getListViewContainer:function(){return!1===this.listViewContainer&&(this.listViewContainer=jQuery("#listViewContent")),this.listViewContainer},updatePagination:function(){var e=this.getListViewContainer(),a=jQuery("#previousPageExist",e).val(),t=jQuery("#nextPageExist",e).val(),i=jQuery("#PreviousPageButton",e),r=jQuery("#NextPageButton",e),n=jQuery("#PageJump",e),s=parseInt(jQuery("#noOfEntries",e).val()),o=parseInt(jQuery("#pageStartRange",e).val()),l=parseInt(jQuery("#pageEndRange",e).val()),d=jQuery("#totalPageCount",e).text(),u=jQuery(".totalNumberOfRecords",e),c=jQuery(".pageNumbersText",e),p=jQuery("#pageNumber",e).val();if(jQuery("#pageToJump",e).val(p),d>1&&n.removeAttr("disabled"),""!==a?i.removeAttr("disabled"):""===a&&i.attr("disabled","disabled"),""!==t?r.removeAttr("disabled"):""!==t&&1!==d||r.attr("disabled","disabled"),0!==s){var v=o+" "+app.vtranslate("to")+" "+l;c.html(v),u.removeClass("hide")}else c.html("<span>&nbsp;</span>"),u.hasClass("hide")||u.addClass("hide")},initializePaginationEvents:function(){var e=this,a=this.getComponentInstance("Vtiger_Pagination_Js"),t=e.getListViewContainer();a.initialize(t),app.event.on(a.nextPageButtonClickEventName,(function(){t.find("#pageLimit").val(),t.find("#noOfEntries").val();var a=t.find("#nextPageExist").val(),i=t.find("#pageNumber").val(),r=parseInt(parseFloat(i))+1;a&&e.redirectKanbanPage(r)})),app.event.on(a.previousPageButtonClickEventName,(function(){var a=t.find("#pageNumber").val(),i=parseInt(parseFloat(a))-1;a>1&&e.redirectKanbanPage(i)})),app.event.on(a.pageJumpButtonClickEventName,(function(a,t){e.pageJump()})),app.event.on(a.totalNumOfRecordsButtonClickEventName,(function(a,t){e.totalNumOfRecords(t)})),app.event.on(a.pageJumpSubmitButtonClickEvent,(function(a,t){e.pageJumpOnSubmit(t)}))},pageJump:function(){var e,a=this.getListViewContainer(),t=a.find("#totalPageCount");if(""===t.text()){var i=a.find("#totalCount"),r=i.val();if(""!==r){var n=a.find("#pageLimit").val();return"0"===n&&(n=1),0===(e=Math.ceil(r/n))&&(e=1),void t.text(e)}this.getPageCount().then((function(e){var a=e.page;i.val(e.numberOfRecords),0===a&&(a=1),t.text(a)}))}},pageJumpOnSubmit:function(e){var a=this.getListViewContainer(),t=a.find("#pageNumber"),i=parseInt(t.val()),r=parseInt(a.find("#pageToJump").val());if(r>parseInt(a.find("#totalPageCount").text())){var n=app.vtranslate("JS_PAGE_NOT_EXIST");app.helper.showErrorNotification({message:n})}else if(r!==i)this.redirectKanbanPage(r);else{n=app.vtranslate("JS_YOU_ARE_IN_PAGE_NUMBER")+" "+r;app.helper.showAlertNotification({message:n})}},redirectKanbanPage:function(e){this.getListViewContainer();var a=this.getModuleName(),t=app.getParentModuleName(),i=jQuery("#view").val(),r=jQuery("#orderBy").val(),n=jQuery("#sortOrder").val(),s=jQuery("#appName").val(),o=new URLSearchParams({module:a,view:"KanbanView",viewname:i,search_key:jQuery("#search_key").val(),search_value:jQuery("#search_value").val(),search_params:jQuery("#search_params").val(),page:e,parent:t,source_module:jQuery("#kbSourceModule").val(),orderby:r,sortorder:n,app:s});window.location.href="index.php?"+o.toString()},registerEvents:function(){this._super();var e=this;e.fixWidthColumns();var a=jQuery("div.kbContainer");vtUtils.applyFieldElementsView(a),e.registerQuickEditEvent(),e.registerSortableEvent(),e.registerScrollbar(),e.registerEventToShowQuickKanbanPreview(),this.registerAjaxEditEvent(),this.registerAjaxEditSaveEvent(),this.registerAjaxEditCancelEvent(),this.registerDeleteRecordClickEvent(),this.registerStarToggle(),this.registerChangeLinks(),this.registerEventForActivity(),jQuery("#createFilter").data("url","index.php?module=CustomView&view=EditAjax&source_module="+jQuery("#kbSourceModule").val()),app.event.on("post.listViewFilter.click",(function(a,t){e.registerEvents()})),jQuery("#detailView").on("submit",(function(e){e.preventDefault()})),e.initializePaginationEvents(),e.updatePagination()}});
