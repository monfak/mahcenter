/* ********************************************************************************
 * The content of this file is subject to the VTFarsi.ir Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is VTFarsi.ir
 * Portions created by VTFarsi.ir. are Copyright(C) VTFarsi Team
 * All Rights Reserved.
 * ****************************************************************************** */
jQuery.Class("ParsVT_Tutorials_Js",{deleteVideoRecord:function(e,a){app.helper.showConfirmationBox({message:app.vtranslate("LBL_DELETE_CONFIRMATION")}).then((function(){app.helper.showProgress(app.vtranslate("JSLBL_Deleting")+"...");var t={module:"ParsVT",action:"Fields",type:e,record:a,mode:"deleteVideo"};app.request.post({data:t}).then((function(e,a){app.helper.hideProgress(),null===e?setTimeout((function(){window.location.reload(1)}),500):app.helper.showErrorNotification({message:app.vtranslate(e.message)})}))}))},cleanAllTutorials:function(){app.helper.showConfirmationBox({message:app.vtranslate("LBL_DELETE_CONFIRMATION")}).then((function(){app.helper.showProgress(app.vtranslate("JSLBL_Deleting")+"...");app.request.post({data:{module:"ParsVT",action:"Fields",mode:"cleanAllTutorials"}}).then((function(e,a){app.helper.hideProgress(),null===e&&setTimeout((function(){window.location.reload(1)}),1e3)}))}))}},{SaveTrainingVideosSettings:function(){$('select[name="upload_type"]').on("change",(function(){"URL"===$(this).val()?$('input[name="path_video"]').attr("type","url"):$('input[name="path_video"]').attr("type","file")})),$(".row_position").sortable({delay:150,stop:function(){var e=new Array;$(".row_position>tr").each((function(){e.push($(this).attr("id"))}));var a={module:"ParsVT",action:"TutorialsAjax",mode:"DynamicDragandDrop",data:e};app.request.post({data:a}).then((function(e,a){null===e?app.helper.showSuccessNotification({message:app.vtranslate("Settings Saved successfully!")}):app.helper.showErrorNotification({message:"Error"})}))}}),$(".SaveTrainingVideos").click((function(){let e=$(this).attr("typeof"),a=$("#PageType").val(),t=$("#RecordID").val(),o=$("#"+e).serializeArray(),s="",r="",i="",n=app.getModuleName();var p=new FormData;"SaveVideoForm"==e&&("File"==o[3].value?(r="File",s=$("#UploadedFiles")[0].files[0],p.append("img",$("#UploadedFiles")[0].files[0])):r="URL",p.append("Data",JSON.stringify(o)),p.append("action","TutorialsAjax"),p.append("module",n),p.append("mode","SaveVideoForm"),p.append("recordid",t),p.append("ProcessType",a),p.append("TypeFile",r),console.dir(o)),"SaveVideoForm"==e?$.ajax({url:"index.php",type:"post",cache:!1,contentType:!1,processType:!1,data:p,processData:!1,success:function(e){Response=JSON.stringify(e),Res=jQuery.parseJSON(Response),!0===Res.result.return?(app.helper.showSuccessNotification({message:"Settings saved successfully"}),window.location.href="index.php?module=ParsVT&parent=Settings&view=Tutorials&mode=Videos"):("FormatIncorrect"===Res.result.Message&&app.helper.showErrorNotification({message:app.vtranslate("The file format is wrong")}),"unset Video!"===Res.result.Message&&app.helper.showErrorNotification({message:app.vtranslate("FileNotUploaded")}),"Error"===Res.result.Message&&app.helper.showErrorNotification({message:app.vtranslate("Error")}),"CustomViewFieldNotNull"===Res.result.Message&&app.helper.showErrorNotification({message:app.vtranslate("CustomViewFieldNotNull")}))},error:function(e){app.helper.showErrorNotification({message:app.vtranslate("Mandatory fields cannot be empty")})}}):(i={module:n,action:"TutorialsAjax",mode:e,ProcessType:a,recordid:t,data:o},app.request.post({data:i}).then((function(a,t){null===a?(app.helper.showSuccessNotification({message:app.vtranslate("Settings saved successfully")}),"SaveCategoryForm"===e?window.location.href="index.php?module=ParsVT&parent=Settings&view=Tutorials&mode=Categories":"SaveSubCategoryForm"===e?window.location.href="index.php?module=ParsVT&parent=Settings&view=Tutorials&mode=SubCategories":"SaveVideoForm"===e&&(window.location.href="index.php?module=ParsVT&parent=Settings&view=Tutorials&mode=Videos")):app.helper.showErrorNotification({message:app.vtranslate(a.message)})})))}))},GetSubCategoriesValue:function(){$("#ClassCategoryOnChange").on("change",(function(){var e=$(this).val();let a=app.getModuleName();var t={};params={module:a,action:"TutorialsAjax",mode:"GetSubCcaregoryByID",data:e},app.request.post({data:params}).then((function(e,a){if(null===e){var o=a.CallBackData;$.each(o,(function(e,a){t+='<option value="'+e+'">'+a+"</option>"})),$("#ClassSubCategoryOnChange").empty(),$("#ClassSubCategoryOnChange").empty().val(),$("#ClassSubCategoryOnChange").append(t)}else app.helper.showErrorNotification({message:"Error"})})),console.dir(e)}))},SetInputViewField:function(){$("#ClassViewOnChange").on("change",(function(){"Other"===$(this).val()?$("#OtherSelectView").show(500):$("#OtherSelectView").hide(500)}))}}),jQuery(document).ready((function(){var e=new ParsVT_Tutorials_Js;e.SaveTrainingVideosSettings(),e.GetSubCategoriesValue(),e.SetInputViewField(),Vtiger_Index_Js.getInstance().registerEvents(),$(".videoform").submit((function(e){e.preventDefault()}))}));